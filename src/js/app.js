import Matter, { Constraint } from 'matter-js';
import Paper from 'paper';
import bgImg from '../../cover-01.jpg';
import 'pathseg';

const path = "m29.75,304.69c-.59,0-1.21-.04-1.84-.13-2.08-.28-4.13-.59-6.26-1.29-.84-.27-2.25-.73-3.57-1.79-.16-.13-.44-.27-.9-.45-2.66-1.04-4.6-3.16-5.33-5.82-.77-2.81-.14-5.97,1.63-8.24.24-.31.48-.61.73-.91.39-.48.71-.88,1.02-1.3.79-1.08,1.96-1.95,3.32-2.43.37-.13.72-.23,1.04-.32l.09-.02.07-.07c.33-.33.67-.66.99-1,.56-1.06,1.23-1.98,2.03-2.81l.25-.26-.27-.24c-.6-.52-1.16-1.15-1.67-1.85-.05-.07-.12-.14-.18-.19-2.45-2.01-3.58-4.97-3.09-8.12.09-.6.11-1.29.13-2.1.01-.48.02-.94.05-1.4v-.1s-.04-.12-.04-.12c-.92-1.67-1.12-3.7-.56-5.69.04-.14.13-.46-.07-1.3-.28-1.2-.28-2.33-.29-3.08,0-1.47.02-2.79.07-4.03.05-1.16.19-2.13.44-3.03.17-.61.19-1.25.09-2.03-.15-.64-.38-1.66-.19-2.89.07-.46,0-1.05-.25-1.91-.52-1.85-.34-3.76.51-5.39l.05-.09v-.1c-.09-.89,0-1.66.04-2.17v-.06s0-.22,0-.22c-.37-1.46-.27-2.71-.2-3.63v-.12c.03-.17.04-.34.04-.5,0-.83,0-1.73.1-2.67v-.11s-.04-.09-.04-.09c-1.04-1.88-1.25-3.93-.65-5.84l.06-.21c.09-.34.19-.67.31-.99l.03-.12-.04-.16c-.57-1.24-.76-2.61-.56-3.97l.02-.1-.04-.09c-.14-.31-.25-.62-.34-.95-.14-.49-.4-1.39-.35-2.5-.03-.21-.09-.47-.14-.68-.24-1.01-.58-2.49-.3-4.23l.02-.09-.03-.09c-.6-1.56-.69-3.24-.25-4.85.07-.24.06-.78.05-1.46l-.02-1.45c-.01-1.88-.03-4,.37-6.2.08-.46.12-1.01.16-1.64l.07-1.04-.02-.06c-.41-1.15-.51-2.27-.31-3.35l.05-.26-.5-.24c-.82-.4-1.84-.89-2.85-1.78-1.63-.83-2.78-2-3.51-3.53l-.03-.07-.06-.05c-.61-.51-1.04-1.02-1.35-1.39-.1-.12-.15-.19-.21-.24-1.79-1.72-2.74-3.65-2.83-5.75v-.08s-.04-.07-.04-.07c-.85-1.6-1.07-3.37-.63-5.13l.02-.08-.02-.08c-.28-1.25-.2-2.5.24-3.62l.02-.06v-.06c0-.83.01-2.37.92-3.98l.03-.07.07-.2c.03-.49.12-.99.28-1.48l.02-.07v-.07c-.17-1.56.14-2.91.35-3.8l.07-.32c.02-.2,0-.35,0-.5v-.15c-.02-.32-.03-.65-.02-.97,0-.14,0-.29,0-.43,0-.25-.01-.52,0-.82v-.08s-.04-.07-.04-.07c-.84-1.71-1-3.66-.47-5.64.26-.96.2-1.42.12-1.72-.28-1.06-.21-1.99-.18-2.49v-.14s-.02-.66-.02-.66c-.03-1.09-.07-1.83-.25-2.19-.45-.91-.71-1.9-.76-2.88-.04-.76-.17-1.61-.3-2.51-.16-1.04-.34-2.22-.4-3.46-.06-1.26-.15-2.52-.24-3.78l-.06-.89c-.07-1.07.13-1.96.29-2.54l.03-.12-.05-.11c-.4-.96-.62-1.97-.65-3v-.12s-.54-.62-.54-.62C.42,114.08.03,111.92.03,110.49v-.29c0-1.83-.01-3.65-.03-5.46-.02-1.82.32-3.42,1.04-4.87l.12-.24-.05-.05s0-.06.01-.1c.14-1.11.35-2.14.54-3.14.19-.97.37-1.86.46-2.69.13-1.24.53-2.44,1.16-3.46.09-.15.19-.35.25-.74.18-1.18.57-2.2.85-2.86l.11-.27c.11-.26.27-.62.3-.75.39-1.74,1.1-3.27,2.13-4.56l.05-.06s.04-.21.06-.32l.06-.4c.09-.66.21-1.55.57-2.54.08-1.95.67-3.74,1.82-5.59.06-.09.09-.16.11-.2l.03-.06v-.07c.1-1.43.57-2.85,1.34-3.99l.04-.06v-.08c.02-.07.04-.19.05-.4.03-.94.24-1.9.61-2.85.87-2.21,2.22-3.83,4-4.82l.09-.05.05-.1c.52-1.05,1.17-1.91,1.99-2.64.94-1.52,2.17-2.63,3.71-3.38l.08-.04.05-.07c.26-.34.5-.64.77-.93,1.09-1.18,2.31-1.71,3.04-2.03l.06-.03.12-.08.12-.12c.3-.31.72-.74,1.25-1.15,1.02-.8,2.1-1.08,2.61-1.22.63-.19,1.16-.33,1.69-.48.83-.23,1.11-.46,1.26-.66.64-.81,1.5-1.48,2.47-1.95.85-.41,1.66-1.18,2.61-2.2.28-.3.57-.57.85-.82l.31-.27-.32-.26c-1.37-1.12-2.28-2.45-2.69-3.98-.51-1.08-.75-2.05-.94-2.82-.11-.42-.2-.78-.27-.94-.58-1.01-.83-2.11-.76-3.2-.02-.23-.1-.54-.16-.79-.18-.74-.41-1.71-.44-2.83v-.03s-.02-.09-.02-.09c-.08-.38-.15-.76-.19-1.14v-.15c-.07-.56-.15-1.33-.05-2.23v-.07s-.01-.07-.01-.07c-.45-1.56-.43-3.22.05-4.81.09-.29.09-.43.09-.52-.09-1.53.22-3.86,2.21-6.19.42-.49.81-1,1.19-1.51,1.09-1.46,2.26-2.56,3.6-3.35l.11-.07c1.2-1.03,2.55-1.8,4.01-2.27l.12-.04.07-.1c1.36-2.07,3.52-3.27,5.94-3.32,0,0,.67-.01.88-.01.74,0,1.74.04,2.83.36.1.03.19.04.29.04s.22-.01.36-.04c.98-.19,1.91-.28,2.73-.36.8-.08,1.47-.14,2.03-.28.82-.2,1.69-.3,2.57-.3s1.9.11,2.9.34c1.32.3,2.54.61,3.71.96,2.08.62,3.94,1.83,5.55,3.59.19.21.39.44.58.66.41.47.79.91,1.05,1.09,1.63,1.13,2.75,2.9,3.15,4.98.08.4.26.93,1.07,1.83.77.87,1.39,1.92,1.9,3.22.17.44.32.89.47,1.34.17.51.32.99.47,1.24.8,1.38.92,2.77,1,3.6l.02.26c.08.76.1,1.47.12,2.09v.19c.41,1.15.51,2.08.58,2.7l.03.25c.8,1.93.79,3.94.01,5.76l-.04.1.03.11c.37,1.62.35,3.39-.06,5.27-.04.2-.08.41-.12.62-.07.37-.14.73-.22,1.12l-.05.25.71.42c.69.41,1.33.79,1.81.93,1.01.3,1.98.83,2.96,1.61.24.19.46.33.68.42,1.92.76,3.45,2.13,4.42,3.96l.04.07.06.05c.95.69,1.64,1.46,2.12,2.36.28.51.72,1.1,1.19,1.73.54.72,1.14,1.52,1.68,2.44.27.46.45.76.55.87,1.06.96,1.82,1.99,2.29,3.08.16.38.39.68.76,1,.83.72,1.5,1.66,1.99,2.8.05.13.1.21.12.25l.04.07.06.05c.9.66,1.62,1.52,2.08,2.5l.37.78.27-.82c.52-1.54,1.53-2.78,3.01-3.69l.1-.06.04-.11c.29-.78.69-1.51,1.2-2.16.13-.17.25-.36.36-.55l.09-.14c.47-.76,1.11-1.8,2.15-2.76.14-.2.21-.32.28-.43,1.24-1.9,2.86-3.13,4.79-3.66l.08-.02.06-.05c1.43-1.25,3.06-2,4.84-2.24h.07s.23-.14.23-.14c1.49-.84,3.07-1.26,4.68-1.26,1.18,0,2.38.23,3.56.69.48.18,1.23.31,2.03.43l.7.12c.85.15,2.01.35,3.24.92,1.9.2,3.28.87,4.29,1.36.32.16.72.35.89.4,1.31.41,2.57,1.2,3.55,2.23.53.55,1.36,1.06,2.34,1.64.38.23.7.42,1.02.62,1.69,1.06,2.93,2.32,3.78,3.84.07.12.13.24.19.36,2.02,2.31,2.31,4.96,2.45,6.23l.03.31c.07.63.12,1.08.21,1.32.62,1.75.68,3.69.17,5.6-.11.43-.16.75-.13.99.09.9.14,2.25-.47,3.66-.17.4-.32.81-.48,1.21-.59,1.58-1.28,3.41-2.6,5.1l-.31.39.47.16c1.19.39,2.07,1.04,2.55,1.38.86.63,1.86,1.38,2.79,2.36,1.05,1.1,2.28,2.16,4.13,3.55,1.62,1.22,2.74,2.91,3.16,4.76l.02.07.12.16c.72,1,1.22,2.07,1.54,3.27.43,1.6.96,4.03.68,6.75-.02.14-.02.32.05.61.22.93.31,1.94.28,3.01-.07,2.12-.71,3.96-1.91,5.48l-.09.11.02.14c.05.42.08.85.09,1.28v.07s.03.07.03.07c1.02,2.15,1.05,4.23.98,5.6-.01.24-.03.49-.06.73-.02.17-.02.26-.03.34v.26c.02.23.04.53.06.7,1.06,2.25,1.04,4.35.93,5.74-.07.9-.01,1.92.05,3.01.04.72.08,1.43.09,2.15v.03l.03.15c.06.26.1.46.13.66l.05.2c.15.64.36,1.49.33,2.52-.03,1.19.05,2.45.15,3.78.05.7.1,1.39.13,2.09l.02.6c.54,1.53.7,3.07.52,4.83-.09.91-.07,1.5.07,1.91.29.85.41,1.72.36,2.58-.02.37-.06.74-.1,1.12-.02.21-.05.48-.06.63l.04.25c.09.47.19.98.24,1.56.05.68.16,2.09-.41,3.58-.04.31-.02.8,0,1.17.04.8.01,1.46-.01,1.99l-.02.31c-.04.95-.09,1.89-.14,2.83v.16c-.02.5-.03,1.34-.35,2.31-.25.78-.3,1.04-.31,1.17.19.87.2,1.66.06,2.47v.08s0,.08,0,.08c.37,1.29.41,2.47.41,3.25v.74c0,.7,0,1.4,0,2.1-.03,1.76-.34,3.32-.95,4.77-.13.31-.23.91-.33,1.55l-.04.23c-.31,1.93-.93,3.65-1.47,5.17-.19.54-.38,1.04-.54,1.55-.12.36-.27.71-.46,1.07l-.06.1.02.12c.37,2.24.32,4.46-.16,6.6.16,1.64.28,3.03.36,4.37.04.75.12,2.15-.39,3.63-.17.5-.14,1.37-.1,2.38v.32c.05,1.01,0,1.97-.06,2.77,0,.07,0,.17.05.37.77,2.86.72,5.71-.17,8.47l-.45,1.44v.08c.46,2.74.22,5.33-.03,7.28-.08.58-.06,1.01.04,1.42.64,2.56.67,5.08.1,7.48l-.02.07v.07c.41,2.25.36,4.4.31,6.3l-.03,1.58c.92,2.77.78,5.34.58,7.53-.03.35-.03.72,0,1.19.17,2.36.38,5.31-.56,8.4l-.02.23c-.04,2.21-.75,4.3-2.11,6.24-.14.2-.28.4-.41.61l-.16.25.23.2c3.17,2.75,4.12,6.88,2.48,10.78-.73,1.73-1.8,3.26-3.21,4.55-.47.43-1.34,1.23-2.68,1.65-.26.08-.51.18-.75.28l-.14.06c-1.12.46-2.65,1.08-4.58,1.1-.1,0-.2,0-.3.01-.88.24-1.8.36-2.69.36-.95,0-1.9-.14-2.82-.41l-.24-.04c-.25-.03-.49-.06-.73-.11l-.11-.02-.1.05c-1.39.65-2.92.98-4.55.98-.73,0-1.48-.06-2.31-.19l-.43-.07c-.68-.11-1.36-.22-2.04-.36-3.14-.65-5.69-2.62-7.18-5.54-.54-1.06-.87-2.21-.94-3.34-.08-1.32-.2-3.11.45-5.03l.03-.08v-.08c-.15-1.07-.2-2.19-.17-3.33v-.2s-.17-.1-.17-.1c-.15-.09-.3-.18-.44-.28l-.31-.21-.19.32c-.72,1.2-1.35,2.24-1.61,3.2-.31,1.17-.88,2.89-2.2,4.3-.28.31-.51.78-.81,1.68-.49,1.49-1.31,2.84-2.51,4.13-.46.5-.91,1.01-1.34,1.52-1.09,1.29-2.49,2.16-4.16,2.6-.57.15-.99.26-1.31.39-1.32.54-2.67.81-4.02.81-.63,0-1.26-.06-1.88-.18l-.11-.02-.1.05c-1.68.8-3.5,1.21-5.41,1.21-.48,0-.97-.03-1.46-.08-.38-.04-.76-.05-1.14-.07h-.13c-1.05-.05-2.34-.1-3.73-.43l-.06-.02h-.07c-.64.1-1.29.14-2.01.14-.82,0-1.62-.06-2.25-.11-.46-.04-.85-.07-1.24-.08-.9-.03-1.66-.2-2.17-.32l-.13-.03-.12.07c-1.53.89-3.24,1.34-5.07,1.34-1.17,0-2.38-.18-3.68-.55-.71-.2-1.49-.29-2.7-.31-1.11-.02-2.57-.07-4.1-.28-3.24-.45-5.82-2.38-7.27-5.42l-.52-1.09-.14,1.19c-.24,1.98-1.07,3.88-2.54,5.8-1.31,1.7-3.22,2.79-5.23,3h-.06s-.06.03-.06.03c-.07.04-.21.11-.44.25-1.61.97-3.43,1.56-5.4,1.74-.91.09-1.95.18-3.06.18-.43,0-.85-.01-1.27-.05-.22-.02-.43-.03-.63-.03-.12,0-.32,0-.42.04-1.43.83-2.86.98-3.81,1.09l-.24.03c-1.66.19-3.45.38-5.29.49-.42.02-.83.03-1.24.03-.81,0-1.63-.04-2.44-.08-.42-.02-.72-.03-1.01-.03-.42,0-.7.03-.88.1-1.15.43-2.41.64-3.73.64Z";
const SVG_PATH_SELECTOR = '#two-ppl';
const p1 = path.split(',');

var Engine = Matter.Engine,
    Render = Matter.Render,
    Body = Matter.Body;
    Runner = Matter.Runner,
    World = Matter.World,
    MouseConstraint = Matter.MouseConstraint,
    Mouse = Matter.Mouse,
    Composite = Matter.Composite,
    Bodies = Matter.Bodies;
    Constraint = Matter.Constraint;
    Svg = Matter.Svg;
    Vector = Matter.Vector;
    Vertices = Matter.Vertices;


    class Sketch {
        constructor(){
            this.time = 0;
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.mouse = {
                x:300,y:300
            }
            this.initPaper();
            this.physics();
            this.addObjects();
            this.mouseEvents();
            this.renderLoop();
            this.createSvgBodies();
        }

        createSvgBodies(){
            this.paths = p1;
            console.log(this.paths);
            //let vertices = Svg.pathToVertices(this.paths);
            //console.log(vertices);
                // let scaleFactor = 1;
                // vertices = Vertices.scale (vertices, scaleFactor, scaleFactor);
                let svgBody = Bodies.fromVertices(
                     0,
                     0,
                    [this.paths]
                );
                Composite.add(this.engine.world, svgBody);
        }

        mouseEvents(){
            this.render.canvas.addEventListener('mousemove', (e)=>{
                this.mouse.x = e.clientX - this.cursor.positionPrev.x;
                this.mouse.y = e.clientY - this.cursor.positionPrev.y;
            })
        }

        physics(){
            // create engine
            this.engine = Engine.create(),
            this.world = this.engine.world;

            this.engine.gravity.x = 0;
            this.engine.gravity.y = 0;

                // create renderer
            this.render = Render.create({
                    element: document.querySelector('#container'),
                    engine: this.engine,
                    options: {
                        width: this.width,
                        height: this.height,
                        showVelocity: true
                    }
            });


            Render.run(this.render);
                
            // create runner
            this.runner = Runner.create();
            Runner.run(this.runner, this.engine);
        }

        addObjects(){

            
            this.pp = new Paper.Path(path);

            this.pp.fillColor = '#ff0000';
            this.number = this.pp.segments.length;

            /*
            this.shadow = new Paper.Path(path);
            this.shadow.fillColor = '#00ff00';
            this.shadow.shadowBlur = 30;
            this.shadow.shadowColor = '#ff0000';
            */

            // Grouping for clipping mask
            this.group = new Paper.Group([this.pp]);
            this.group.clipped = true; // this sets the mask cliping 

            let img = new Image();
            img.onload = ()=>{
                let rasterImg = new Paper.Raster(img);
                rasterImg.fitBounds(Paper.view.bounds, true);
                this.group.addChild(rasterImg);
            }
            img.src = bgImg;


            this.circles = [];
            this.anchors = [];
            this.links = [];

            this.cursor = Bodies.circle(300, 300, 50,{
                isStatic: false
            });

            this.center = Bodies.circle(290, 250, 50,{
                isStatic: false
            });


            for (let i = 0; i<this.number; i++){
                this.circles.push(
                    Bodies.circle(
                        this.pp.segments[i].point.x + 200,
                        this.pp.segments[i].point.y + 100,
                        1,{
                            density: 0.005,
                            restitution: 0
                        }
                    )
                )
                this.anchors.push(
                    Bodies.circle(
                        this.pp.segments[i].point.x + 200,
                        this.pp.segments[i].point.y + 100,
                        1,{
                            density: 0.005,
                            restitution: 0
                        }
                    )
                )
            }

            for (let i = 0; i<this.number; i++){
                let next = this.circles[i+1] ? this.circles[i+1] : this.circles[0];
                this.links.push(
                    Constraint.create({
                        bodyA: this.circles[i],
                        bodyB: this.anchors[i],
                        stiffness: 1
                    })
                );

                this.links.push(
                    Constraint.create({
                        bodyA: this.circles[i],
                        bodyB: next,
                        stiffness: 0.04
                    })
                );

                this.links.push(
                    Constraint.create({
                        bodyA: this.circles[i],
                        bodyB: this.center,
                        stiffness: 0.4
                    })
                );
                let nextnext = this.circles[(i+2)%this.number];
                this.links.push(
                    Constraint.create({
                        bodyA: this.circles[i],
                        bodyB: nextnext,
                        stiffness: 0.4
                    })
                );
            }





            //World.add(this.engine.world, this.circles);
            World.add(this.engine.world, this.cursor);
            World.add(this.engine.world, this.links);
            World.add(this.engine.world, this.center);


        }

        initPaper(){
            this.paperCanvas = document.getElementById('paper');
            this.project = new Paper.Project(this.paperCanvas);
        }

        renderLoop(){
            this.time += 0.05;

            this.pp.smooth();
            //this.shadow.smooth();


            // Syncing up physics and paper render 
            for(let i=0; i < this.number; i++){
                this.pp.segments[i].point.x = this.circles[i].position.x;
                this.pp.segments[i].point.y = this.circles[i].position.y;
                //this.shadow.segments[i].point.x = this.circles[i].position.x;
                //this.shadow.segments[i].point.y = this.circles[i].position.y;

            }

            Body.translate(this.cursor,{
                x:this.mouse.x,
                y:this.mouse.y
            })
            window.requestAnimationFrame(this.renderLoop.bind(this));
        }
    }

    new Sketch();